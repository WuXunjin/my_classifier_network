# 我自己写的分类的网络

因为这个分类的模型是所有的基础我认为,所以打算好好弄一弄这个[一脸认真]

<font color="B2222">注意:所有的包,模块,必须要注释上这块要怎么使用</font>

主要是针对Pytorch

首先好好考虑这个工程需要做些什么,有些什么内容,弄成以后也可以使用的样子

 - 首先是数据:关于pytorch中模型训练的时候的数据集处理,我需要第一多读代码,第二好好组织一下
 - 然后是模型:现有的基础网络,我只会VGG,resNet和denseNet也只能算是用过,其实还有其他很多基础网络的.
 万一以后要调某个实验的性能的话,替换基础网络有时候也是需要的,所以我要考虑,搜集这些网络,实现起来以后
 使用的时候怎么样才能更方便呢.
 - 接下来是训练:训练的函数现在也就只看过两个,似乎都是差不多的,但是还是要积累
 - 然后是测试,我们需要单张图片的测试,也需要对整个数据集的测试(输入data loader),也需要测度
 - 最后是补充,损失函数什么的,测试的测度什么的,测度包含在测试文件夹里面吧,损失函数的话弄在训练
 文件夹里面吧
 
 分析:模型设计可能有变化,对于输入图片要求变化,数据集读取图片后需要transformer.
  - 所以把模型载入好,装入数据集类中进行打包(装饰),数据集类就能够得到模型需要的输入样式.
  - 另外再构建一个参数类,针对某个trainer需要的训练参数,这样不同的trainer需要不同的参数类型.
用参数类来专门实现自动化打印参数到txt中存储实验参数.
  - 关于测试,暂时还没有想好,好像也可以建立一个测试类,测试分几块:数据,模型,数据处理方法,结果保存
  暂时没想好要怎么弄
      - 测试数据集 data,data loader另外写

[TOC]

---
 
## 数据集

针对分类的工作,我先弄一个数据集吧,在iCoseg上面做一下分类 #TODO pascal多标签分类.

数据集一定要把固定的数据集路径,图片标签,gt位置,等等集成到一个类里面,详细应用的时候,再写具体的
一些实现:装饰器模式(可能不是的)


### iCoseg

iCoseg数据集,包含38个类别的图片,每个类别的图片分别存放在不同的文件夹下面,类别名字为文件夹名字.
所以标签的读取就按照文件名来读取就好了.

### VOC数据集
写了两个VOC_dataset是用来训练多标签分类的模型的
VOC_data_seg是用来训练分割的模型的，都还没有加入10582的数据(VOC_dataset_aug)

---
## 模型

先弄一个VGG16模型吧,我这里暂时只有这个的预训练模型

[mobile net](https://github.com/marvis/pytorch-mobilenet)

### VGG16
实现的功能是:载入预训练模型参数,模型的实现要方便增加跳层连接或者一些其他的结构变化

---
## 训练

训练的话,输入就只需要数据loader,模型,其他参数比如训练方式,损失函数,epoch等等细节参数考虑一下怎么弄

---
## 测试

这个稍微简单一点,给个图片路径,给出测试结果就完成了基本功能
下一步就是给一个数据集,输出测试结果.**注意:测试结果怎么保存,保存在哪里要好好考虑**


---
## 损失

损失函数是有很多很多的,不同的损失函数有不同的功能,我们要不断地学习才行

---
## 补充

不知道写这个代码的时候会不会有什么补充的东西,再说吧

## 5.13更新
在main_train_v1 里面实现了VGG模型训练pascal voc的多标签分类，损失函数用的是criterion = nn.MultiLabelSoftMarginLoss()
但是测试了一下比如说图片中有两类15和5分别是人和瓶子，人的fc输出得分是9瓶子的是-0.4,其他都是-5以下，也就是说瓶子的得分还是很脆弱的。
考虑换一个loss函数，也就是说模型对小目标的感知能力还是不足，在卷积池化过程中丢掉了很多东西。

那么，有一个关键的问题，就是我要怎么评测我的可判别谱的好坏呢，那就按照grad cam里面的对可判别谱取阈值处理成语义分割结果进行评测吧
先写一个获取grad cam的函数，输入是保存文件夹，图像路径，模型，输出就将获取的语义分割结果png，21类保存下来
